---
layout: default
---

<div class="home">

  <div class="index">
    <h1 class="page-heading">Posts</h1>

    {% for post in site.posts %}
      <article>
        <div class="meta">
          <span class="date">{{ post.date | date: "%b %-d, %Y" }}</span>
          {% if post.location %}<span class="location">{{ post.location }}</span>{% endif %}
          <h2><a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}</a></h2>
        </div>

        <section class="gallery">
          {% assign gallery = post.path | split: '/' | last | split: '.' | first %}
          <div class="photo hero">
            {% comment %}
              @TODO: So apparently the "where" filter doesn't work on custom data
              arrays, though I could write a plugin to do it. Instead, we loop over
              the whole post photo array and pull out the hero when we find it. Sadface.
            {% endcomment %}
            {% for photo in site.data.index[gallery].contents %}
              {% if photo[1].hero %}
                <a href="{{ post.url | prepend: site.baseurl }}">
                  <img src="/photo/thumb/{{ gallery }}/{{ photo[0] }}" />
                </a>
              {% endif %}
            {% endfor %}
          </div>
          <div class="preview">
            {% for photo in site.data.index[gallery].contents limit:5 %}
              {% unless photo[1].hero %}
                <div class="photo">
                  <a href="{{ post.url | prepend: site.baseurl }}">
                    <img src="/photo/thumb/{{ gallery }}/{{ photo[0] }}" />
                  </a>
                </div>
              {% endunless %}
            {% endfor %}
          </div>
        </section>
      </article>
    {% endfor %}
  </div>

  <p class="rss-subscribe">subscribe <a href="{{ "/feed.xml" | prepend: site.baseurl }}">via RSS</a></p>

</div>
